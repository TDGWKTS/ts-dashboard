<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½‰é‹ç«™æ•¸æ“šå„€è¡¨æ¿</title>
    <!-- Fixed CSS paths - remove css/ prefix -->
    <link rel="stylesheet" href="base.css">
    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="stats-cards.css">
    <link rel="stylesheet" href="charts.css">
    <link rel="stylesheet" href="table.css">
    <link rel="stylesheet" href="utilities.css">
    <link rel="icon" href="my-logo.png">
</head>
<body>
    <!-- Immediate authentication check -->
     <script>
        (function() {
            const currentUser = localStorage.getItem('ts_user');
            console.log('Dashboard auth check - User:', currentUser);
            
            if (!currentUser) {
                console.log('No user found, redirecting to login...');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('User authenticated:', currentUser);
        })();
    </script>
    <script>
        // IMMEDIATE redirect if not authenticated - don't wait for DOMContentLoaded
        const currentUser = localStorage.getItem('ts_user');
        if (!currentUser) {
            window.location.href = 'index.html';
        }
    </script>

    <div class="sidebar-layout">
        <!-- Mobile Navigation Header -->
        <div class="mobile-header hidden">
            <button class="mobile-menu-btn" id="mobileMenuBtn">â˜°</button>
            <div class="mobile-logo">ğŸ­ TS Dashboard</div>
            <div class="mobile-user" id="mobileUser"></div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="logo-section">
                <div class="logo-text">ğŸ­ TS Dashboard</div>
                <div class="user-info">
                    <span id="userFullName"></span>
                    <small id="userRole"></small>
                </div>
            </div>
            
            <nav id="sidebarNav" class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-title">æˆ‘çš„è½‰é‹ç«™</div>
                </div>
                
                <div class="nav-section admin-section hidden" id="adminSection">
                    <div class="nav-title">æ‰€æœ‰è½‰é‹ç«™</div>
                </div>
            </nav>
        </div>
        
        <div class="main-content">
           <header class="header">
    <div class="filter-section">
        <div class="filter-group">
            <label>æ—¥æœŸç¯„åœ:</label>
            <select id="dateRangeFilter">
                <option value="currentQuarter">æœ¬å­£åº¦</option>
                <option value="firstQuarter" selected>ç¬¬ä¸€å­£åº¦ (1æœˆ-3æœˆ)</option>
                <option value="secondQuarter">ç¬¬äºŒå­£åº¦ (4æœˆ-6æœˆ)</option>
                <option value="thirdQuarter">ç¬¬ä¸‰å­£åº¦ (7æœˆ-9æœˆ)</option>
                <option value="fourthQuarter">ç¬¬å››å­£åº¦ (10æœˆ-12æœˆ)</option>
                <option value="firstHalf">ä¸ŠåŠå¹´ (1æœˆ-6æœˆ)</option>
                <option value="secondHalf">ä¸‹åŠå¹´ (7æœˆ-12æœˆ)</option>
                <option value="1year">å…¨å¹´</option>
                <option value="custom">è‡ªè¨‚æ—¥æœŸç¯„åœ</option>
                <option value="specificDate">æŒ‡å®šå–®ä¸€æ—¥æœŸ</option>
            </select>
        </div>
        
        <!-- Custom Date Range Selector (Hidden by default) -->
        <div class="filter-group custom-date-range hidden" id="customDateRange">
            <label>è‡ªè¨‚ç¯„åœ:</label>
            <input type="date" id="startDate" class="date-input">
            <span>è‡³</span>
            <input type="date" id="endDate" class="date-input">
        </div>
        
        <!-- Specific Date Selector (Hidden by default) -->
        <div class="filter-group specific-date hidden" id="specificDateSelector">
            <label>æŒ‡å®šæ—¥æœŸ:</label>
            <input type="date" id="specificDate" class="date-input">
        </div>
        
        <!-- Updated Waste Category Filter with Checkboxes -->
        <div class="filter-group">
            <label class="filter-label">å»¢ç‰©é¡åˆ¥</label>
            <div id="wasteCategoryFilter" class="checkbox-filter-container">
                <!-- Checkbox options will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Updated Source Region Filter with Checkboxes -->
        <div class="filter-group">
            <label class="filter-label">ä¾†æºåœ°å€</label>
            <div id="sourceFilter" class="checkbox-filter-container">
                <!-- Checkbox options will be populated by JavaScript -->
            </div>
        </div>
        
        <button id="applyFilters" class="filter-btn">æ‡‰ç”¨ç¯©é¸</button>
        <button id="compareBtn" class="filter-btn secondary hidden">æ¯”è¼ƒæ‰€æœ‰è½‰é‹ç«™</button>
    </div>
    
    <div class="user-section">
        <span id="currentUser"></span>
        <button id="logout" class="logout-btn">ç™»å‡º</button>
    </div>
</header>
            
            <main class="content-area">
                <!-- Loading Indicator -->
                <div id="loadingIndicator" class="global-loader hidden">
                    <div class="loader-content">
                        <div class="spinner"></div>
                        <p>åŠ è¼‰æ•¸æ“šä¸­...</p>
                        <small>ä¸€å¹´æ•¸æ“šå¯èƒ½éœ€è¦ 10-15 ç§’</small>
                    </div>
                </div>

                <div class="welcome-page" id="welcomePage">
                    <div class="welcome-content">
                        <div class="logo-text large">ğŸ­ TS Dashboard</div>
                        <h1>æ­¡è¿ä½¿ç”¨è½‰é‹ç«™æ•¸æ“šå„€è¡¨æ¿</h1>
                        <p>è«‹å¾å·¦å´é¸æ“‡è½‰é‹ç«™ä»¥æŸ¥çœ‹æ•¸æ“š</p>
                        <div class="welcome-features">
                            <div class="feature-card">
                                <h3>ğŸ“Š å¯¦æ™‚æ•¸æ“š</h3>
                                <p>å³æ™‚æŸ¥çœ‹è½‰é‹ç«™é‹ç‡Ÿæ•¸æ“š</p>
                            </div>
                            <div class="feature-card">
                                <h3>ğŸ“ˆ åˆ†æå ±å‘Š</h3>
                                <p>æ·±åº¦åˆ†æå»¢ç‰©è™•ç†è¶¨å‹¢</p>
                            </div>
                            <div class="feature-card">
                                <h3>ğŸ” å¤šç¶­ç¯©é¸</h3>
                                <p>æŒ‰æ™‚é–“ã€åœ°å€ã€é¡åˆ¥ç¯©é¸æ•¸æ“š</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-content hidden" id="dashboardContent">
                    <section class="section">
                        <h2 class="section-title">çµ±è¨ˆæ¦‚è¦½</h2>
                        <div class="stats-grid" id="statsCards">
                            <!-- Stats cards will be populated here -->
                        </div>
                    </section>
                    
                    <section class="section">
                        <h2 class="section-title">æ•¸æ“šåœ–è¡¨</h2>
                        <div class="charts-container" id="chartsContainer">
                            <!-- Charts will be rendered here -->
                        </div>
                    </section>
                    
                    <section class="section">
                        <div class="table-header">
                            <h2 class="section-title">äº¤æ˜“è¨˜éŒ„</h2>
                            <button id="exportCSV" class="export-btn">ğŸ“¥ å°å‡º CSV</button>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>è½‰é‹ç«™</th>
                                        <th>æ—¥æœŸ</th>
                                        <th>äº¤æ”¶ç‹€æ…‹</th>
                                        <th>è»Šè¼›ä»»å‹™</th>
                                        <th>å…¥ç£…æ™‚é–“</th>
                                        <th>ç‰©æ–™é‡é‡ (å™¸)</th>
                                        <th>å»¢ç‰©é¡åˆ¥</th>
                                        <th>ä¾†æº</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTable">
                                    <!-- Table data will be populated here -->
                                </tbody>
                            </table>
                            <div class="table-pagination">
                                <div class="pagination-info" id="paginationInfo"></div>
                                <div class="pagination-controls" id="paginationControls"></div>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="dashboard.js"></script>
    <script src="mobile-nav.js"></script>

    <!-- Global error handler -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
        });
    </script>
</body>
</html>



